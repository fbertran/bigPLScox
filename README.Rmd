<!-- README.md is generated from README.Rmd. Please edit that file -->


```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  dpi=300,fig.width=7,
  fig.keep="all",
  eval=FALSE
)
```

# bigPLScox <img src="man/figures/logo_bigPLScox.svg" align="right" width="200"/>

# bigPLScox, PLS models and their extension for big data in R
## Frédéric Bertrand and Myriam Maumy-Bertrand

<!-- badges: start -->
[![R-CMD-check](https://github.com/fbertran/bigPLScox/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/fbertran/bigPLScox/actions/workflows/R-CMD-check.yaml)
[![R-hub](https://github.com/fbertran/bigPLScox/actions/workflows/rhub.yaml/badge.svg)](https://github.com/fbertran/bigPLScox/actions/workflows/rhub.yaml)
<!-- badges: end -->


The goal of bigPLScox is provide Cox models in a high dimensional setting in R.



Support for parallel computation and GPU is being developed.


This website and these examples were created by F. Bertrand and M. Maumy-Bertrand.

## Installation

You can install the released version of bigPLScox from [CRAN](https://CRAN.R-project.org) with:

```{r, eval = FALSE}
install.packages("bigPLScox")
```

You can install the development version of bigPLScox from [github](https://github.com) with:

```{r, eval = FALSE}
devtools::install_github("fbertran/bigPLScox")
```

# Example

## Allelotyping real dataset

### The dataset

```{r microcensure, eval = TRUE}
library(plsRcox)
data(micro.censure)
Y_train_micro <- micro.censure$survyear[1:80]
C_train_micro <- micro.censure$DC[1:80]
Y_test_micro <- micro.censure$survyear[81:117]
C_test_micro <- micro.censure$DC[81:117]

data(Xmicro.censure_compl_imp)
X_train_micro <- apply((as.matrix(Xmicro.censure_compl_imp)),FUN="as.numeric",MARGIN=2)[1:80,]
X_train_micro_df <- data.frame(X_train_micro)

X_train_micro_orig <- Xmicro.censure_compl_imp[1:80,]
X_train_micro_orig_df <- data.frame(X_train_micro_orig)
```

### Compute deviance residuals with some options.

```{r devianceresiduals, cache=FALSE, eval = TRUE}
computeDR(Y_train_micro,C_train_micro,plot=TRUE)[1:6,1:6]
```

## Simulated data

### Generate dataset

```{r simdata, eval = FALSE}
set.seed(4669)
library(bigPLScox)
x_sim <- matrix(sample(0:1, size = 20000, replace = TRUE), ncol = 2)
dCox_sim <- dataCox(10^4, lambda = 3, rho = 2, x_sim,
beta = c(1,3), cens.rate = 5)
```

```{r simdataload, eval = TRUE}
data(dCox_sim)
```

### Compute deviance residuals with some options.

```{r devianceresiduals2, cache=FALSE, eval = TRUE}
with(dCox_sim,temp<-computeDR(time,status,plot=TRUE))
rm(temp)
```

### Model Matrix

```{r, cache=FALSE, eval = TRUE}
coxgpls(~.,Y_train_micro,C_train_micro,ncomp=6,trace=TRUE,model_matrix=TRUE,dataXplan = X_train_micro_orig_df,ind.block.x=c(3,10,20))[1:20,1:6]
```

### coxgpls
```{r, cache=FALSE, eval = TRUE}
cox_gpls_fit=coxgpls(X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15))
cox_gpls_fit
```

```{r, cache=FALSE, eval = TRUE}
cox_gpls_fit2=coxgpls(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15))
cox_gpls_fit2
```

```{r, cache=FALSE, eval = TRUE}
cox_gpls_fit3=coxgpls(~.,Y_train_micro,C_train_micro,ncomp=6,
dataXplan=X_train_micro_df,ind.block.x=c(3,10,15))
cox_gpls_fit3
```

```{r, eval = TRUE}
rm(cox_gpls_fit,cox_gpls_fit2,cox_gpls_fit3)
```

### cv.coxgpls
```{r cvcoxgpls, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(123456)
cv.coxgpls.res=cv.coxgpls(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10,ind.block.x=c(3,10,15))
```


### coxgplsDR

```{r coxgplsDR, cache=FALSE, eval = TRUE}
cox_gplsDR_fit=coxgplsDR(X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15))
cox_gplsDR_fit
```

```{r coxgplsDR2, cache=FALSE, eval = TRUE}
cox_gplsDR_fit2=coxgplsDR(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15))
cox_gplsDR_fit2
```

```{r coxgplsDR3, cache=FALSE, eval = TRUE}
cox_gplsDR_fit3=coxgplsDR(~.,Y_train_micro,C_train_micro,ncomp=6,
dataXplan=X_train_micro_df,ind.block.x=c(3,10,15))
cox_gplsDR_fit3
```

```{r, eval = TRUE}
rm(cox_gplsDR_fit,cox_gplsDR_fit2,cox_gplsDR_fit3)
```

### cv.coxgplsDR

```{r cvcoxgplsDR, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(123456)

cv.coxsplsDR.res=cv.coxgplsDR(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10,ind.block.x=c(3,10,15))
cv.coxsplsDR.res
```


### coxDKgplsDR

```{r coxDKgplsDR, cache=FALSE, eval = TRUE}
cox_DKsplsDR_fit=coxDKgplsDR(X_train_micro,Y_train_micro,C_train_micro,ncomp=6, validation="CV",ind.block.x=c(3,10,15),verbose=TRUE)
cox_DKsplsDR_fit
```

```{r coxDKgplsDR2, cache=FALSE, eval = TRUE}
cox_DKsplsDR_fit2=coxDKgplsDR(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6, validation="CV",ind.block.x=c(3,10,15))
cox_DKsplsDR_fit2
```

```{r coxDKgplsDR3, cache=FALSE, eval = TRUE}
cox_DKsplsDR_fit3=coxDKgplsDR(~.,Y_train_micro,C_train_micro,ncomp=6,
validation="CV",dataXplan=data.frame(X_train_micro),ind.block.x=c(3,10,15))
cox_DKsplsDR_fit3
```

```{r, eval = TRUE}
rm(cox_DKsplsDR_fit, cox_DKsplsDR_fit2, cox_DKsplsDR_fit3)
```

### cv.coxDKgPLSDR

```{r cvcoxDKgplsDR, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(123456)

cv.coxDKgplsDR.res=cv.coxDKgplsDR(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10,ind.block.x=c(3,10,15))
cv.coxDKgplsDR.res
```

### coxsgpls
```{r, cache=FALSE, eval = TRUE}
cox_sgpls_fit=coxsgpls(X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 6))
cox_sgpls_fit
```

```{r, cache=FALSE, eval = TRUE}
cox_sgpls_fit2=coxsgpls(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 6))
cox_sgpls_fit2
```

```{r, cache=FALSE, eval = TRUE}
cox_sgpls_fit3=coxsgpls(~.,Y_train_micro,C_train_micro,ncomp=6,
dataXplan=X_train_micro_df,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 6))
cox_sgpls_fit3
```

```{r, eval = TRUE}
rm(cox_sgpls_fit,cox_sgpls_fit2,cox_sgpls_fit3)
```

### cv.coxsgpls
```{r cvcoxsgls, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(123456)
cv.coxsgpls.res=cv.coxsgpls(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10))
cv.coxsgpls.res
```

### coxsgplsDR

```{r coxsgplsDR, cache=FALSE, eval = TRUE}
cox_sgplsDR_fit=coxsgplsDR(X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10))
cox_sgplsDR_fit
```

```{r coxsgplsDR2, cache=FALSE, eval = TRUE}
cox_sgplsDR_fit2=coxsgplsDR(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10))
cox_sgplsDR_fit2
```

```{r coxsgplsDR3, cache=FALSE, eval = TRUE}
cox_sgplsDR_fit3=coxsgplsDR(~.,Y_train_micro,C_train_micro,ncomp=6, dataXplan=X_train_micro_df,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10))
cox_sgplsDR_fit3
```

```{r, eval = TRUE}
rm(cox_sgplsDR_fit,cox_sgplsDR_fit2,cox_sgplsDR_fit3)
```

### cv.coxsgplsDR

```{r cvcoxsgplsDR, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(4669)

cv.coxsgplsDR.res=cv.coxsgplsDR(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10))
```


### coxDKsgplsDR

```{r coxDKsgplsDR, cache=FALSE, eval = TRUE}
cox_DKsgplsDR_fit=coxDKsgplsDR(X_train_micro,Y_train_micro,C_train_micro,ncomp=6, validation="CV",ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10),verbose=TRUE)
cox_DKsgplsDR_fit
```

```{r coxDKsgplsDR2, cache=FALSE, eval = TRUE}
cox_DKsgplsDR_fit2=coxDKsgplsDR(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6, validation="CV",ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10))
cox_DKsgplsDR_fit2
```

```{r coxDKsgplsDR3, cache=FALSE, eval = TRUE}
cox_DKsgplsDR_fit3=coxDKsgplsDR(~.,Y_train_micro,C_train_micro,ncomp=6, validation="CV",dataXplan=data.frame(X_train_micro),ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10))
cox_DKsgplsDR_fit3
```

```{r, eval = TRUE}
rm(cox_DKsgplsDR_fit, cox_DKsgplsDR_fit2, cox_DKsgplsDR_fit3)
```

### cv.coxDKgplsDR

```{r cvcoxDKgplsDR2, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(123456)

cv.coxDKgplsDR.res=cv.coxDKgplsDR(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10,ind.block.x=c(3,10,15), alpha.x = rep(0.95, 10))
```



### coxspls_sgpls
```{r, cache=FALSE, eval = TRUE}
cox_coxspls_sgpls_fit=coxspls_sgpls(X_train_micro,Y_train_micro,C_train_micro,ncomp=6,keepX = rep(5, 6))
cox_coxspls_sgpls_fit
```

```{r, cache=FALSE, eval = TRUE}
cox_coxspls_sgpls_fit2=coxspls_sgpls(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.keepX = rep(5, 6))
cox_coxspls_sgpls_fit2
```

```{r, cache=FALSE, eval = TRUE}
cox_coxspls_sgpls_fit3=coxspls_sgpls(~.,Y_train_micro,C_train_micro,ncomp=6, dataXplan=X_train_micro_df,keepX = rep(5, 6))
cox_coxspls_sgpls_fit3
```

```{r, eval = TRUE}
rm(cox_coxspls_sgpls_fit, cox_coxspls_sgpls_fit2, cox_coxspls_sgpls_fit3)
```

### cv.coxspls_sgpls
```{r cvcoxsplsDR, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(123456)
(cv.coxspls_sgpls.res=cv.coxspls_sgpls(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10, keepX = rep(5, 10)))
```


### coxspls_sgplsDR

```{r coxspls_sgplsDR, cache=FALSE, eval = TRUE}
cox_spls_sgplsDR_fit=coxspls_sgplsDR(X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15))
```

```{r coxspls_sgplsDR2, cache=FALSE, eval = TRUE}
cox_spls_sgplsDR_fit2=coxspls_sgplsDR(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6,ind.block.x=c(3,10,15))
```

```{r coxspls_sgplsDR3, cache=FALSE, eval = TRUE}
cox_spls_sgplsDR_fit3=coxspls_sgplsDR(~.,Y_train_micro,C_train_micro,ncomp=6,dataXplan=X_train_micro_df,ind.block.x=c(3,10,15))
```


```{r, eval = TRUE}
rm(cox_spls_sgplsDR_fit,cox_spls_sgplsDR_fit2,cox_spls_sgplsDR_fit3)
```

### cv.coxspls_sgplsDR

```{r cvcoxspls_sgplsDR, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(123456)

cv.coxspls_sgplsDR.res=cv.coxspls_sgplsDR(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10,ind.block.x=c(3,10,15))
```


### coxDKspls_sgplsDR

```{r coxDKspls_sgplsDR, cache=FALSE, eval = TRUE}
cox_DKspls_sgplsDR_fit=coxDKspls_sgplsDR(X_train_micro,Y_train_micro,C_train_micro,ncomp=6, validation="CV",ind.block.x=c(3,10,15),verbose=TRUE)
```

```{r coxDKspls_sgplsDR2, cache=FALSE, eval = TRUE}
cox_DKspls_sgplsDR_fit=coxDKspls_sgplsDR(~X_train_micro,Y_train_micro,C_train_micro,ncomp=6, validation="CV",ind.block.x=c(3,10,15))
```

```{r coxDKspls_sgplsDR3, cache=FALSE, eval = TRUE}
cox_DKspls_sgplsDR_fit=coxDKspls_sgplsDR(~.,Y_train_micro,C_train_micro,ncomp=6, validation="CV",dataXplan=data.frame(X_train_micro),ind.block.x=c(3,10,15))
```

```{r, eval = TRUE}
rm(cox_DKspls_sgplsDR_fit, cox_DKspls_sgplsDR_fit2, cox_DKspls_sgplsDR_fit3)
```

### cv.coxDKspls_sgplsDR

```{r cvcoxDKspls_sgplsDR, warning=FALSE, cache=FALSE, eval = TRUE}
set.seed(123456)

cv.coxDKspls_sgplsDR.res=cv.coxDKspls_sgplsDR(list(x=X_train_micro,time=Y_train_micro, status=C_train_micro),nt=10,ind.block.x=c(3,10,15))
```


